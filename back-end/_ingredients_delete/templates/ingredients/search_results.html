{% if ingredients %}
<div id="ingredients-result">
  {% for ingredient in ingredients %}
  <p
    class="ingredient-button {{ ingredient.status }}"
    onclick="load_ingredient_modal(event)"
    ingredient-id="{{ ingredient.id }}"
    url="{% url 'ingredients:ingredient_modal' ingredient_id=ingredient.id %}"
  >
    {{ ingredient }}
  </p>
  {% endfor %}
</div>
{% endif %}
<!-- Load ingredient modal function -->
<script>
  function load_ingredient_modal(event) {
    event.preventDefault();

    let ingredient_id = event.target.getAttribute("ingredient-id");
    let url = event.target.getAttribute("url");

    let modal = $(`#modal-${ingredient_id}`);

    if (modal.length != 0) {
      modal.modal("show");
      return;
    }

    fetch(url, {
      method: "GET",
      headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": "{{ csrf_token }}",
      },
    })
      .then((response) => {
        if (response.ok) {
          return response.text();
        } else {
          throw new Error("Request failed with status " + response.status);
        }
      })
      .then((data) => {
        $("body").append(data);
        $(`#modal-${ingredient_id}`).modal("show");
      })
      .catch((error) => {
        event.target.innerHTML = "Chyba serveru";
        console.log(error);
      });
  }
</script>
